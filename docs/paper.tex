\documentclass[12pt, twoside]{article}
\usepackage{jmlda}
\usepackage{url}
\usepackage{graphicx}

\usepackage[utf8]{inputenc}
\newcommand{\hdir}{.}

\begin{document}

\title
    {Восстановление функциональных групп головного мозга с помощью графовых диффузных моделей}
\author
    {А.\,М.~Астахов, С.\,К.~Панченко, В.\,В.~Стрижов} 
\email
    {astakhov.am@phystech.edu; panchenko.sk@phystech.edu; strijov@phystech.edu}
\abstract{
В данной работе рассматривается задача классификации многомерного временного ряда, представляющего собой электроэнцефалограмму головного мозга человека. Стандартные подходы, использующие двухмерные свертки, не могут учесть пространственную структуру сигнала, поскольку датчики, считывающие показатели, находятся на сферической поверхности. В качестве решения предлагается использовать графовое представление функциональных групп, а для моделирования использовать нейронную диффузию.

\keywords{Головной мозг, ЭЭГ, Графовые нейронные сети, диффузионные модели}

\bigskip

\noindent


}

\maketitle
\par

\section{Введение}

Эмоции играют ключевую роль в человеческом восприятии, принятии решений и социальном взаимодействии. Их автоматическая классификация на основе нейрофизиологических данных, таких как электроэнцефалография (ЭЭГ), открывает новые возможности в психологии, медицине, аффективных вычислениях и человеко-машинном взаимодействии. Однако, несмотря на значительный прогресс в области машинного обучения и нейронаук, точная и надёжная классификация эмоций по ЭЭГ остаётся сложной задачей. Это связано с высокой индивидуальной вариабельностью сигналов, нелинейной природой эмоциональных процессов, а также ограничениями существующих методов предобработки и классификации.

В данной статье рассматриваются современные подходы к распознаванию эмоций по ЭЭГ, анализируются их преимущества и недостатки, а также предлагаются пути улучшения точности классификации. Особое внимание уделяется методам обработки сигналов, выделения информативных признаков и использованию алгоритмов глубокого обучения. Результаты исследования могут быть полезны для разработки более эффективных систем аффективного взаимодействия, нейрореабилитации и психофизиологических исследований. Объектом нашего исследования является сигнал, полученный путём электроэнцефалографического исследования человеческого мозга, воспринимаемый как многомерный временной ряд, где каждая размерность отвечает конкретному датчику на голове испытуемого. Технические ограничения ЭЭГ-исследований включают низкое пространственное разрешение метода и высокую чувствительность к артефактам. Как показано в работе \cite{1}, движения глаз и мышечная активность могут существенно искажать сигнал. Более того, индивидуальные различия в паттернах мозговой активности между испытуемыми значительно снижают эффективность универсальных классификаторов.

Существующие подходы преимущественно основаны на двух теоретических моделях эмоций: локационистской (базовые эмоции) и многомерной (валентность-возбуждение-доминантность, VAD) \cite{3}. Однако большинство современных методов не учитывают пространственные взаимосвязи между электродами, что ограничивает их эффективность.

В исследованиях используются различные методы извлечения признаков:

\textbf{Временные характеристики:} В работе \cite{4} применены шесть статистических параметров ЭЭГ с последующим отбором каналов методами PCA и ReliefF, что позволило достичь точности 81{,}87\% на датасете DEAP. Однако авторы не рассматривали пространственные корреляции между электродами.

\textbf{Частотные характеристики:} Исследование \cite{5} демонстрирует эффективность PCA для сокращения размерности признаков с последующей классификацией методом SVM (точность 85{,}85\% на SEED). Аналогично, в \cite{6} сравнение различных признаков показало, что статистические характеристики в сочетании с KNN дают точность 77{,}54--79\%.

Важное ограничение этих работ заключается в том, что анализ проводился для каждого электрода отдельно, без учёта пространственных взаимодействий между различными областями мозга. Это особенно существенно, поскольку эмоциональные состояния, как известно, связаны с скоординированной активностью распределённых нейронных сетей \cite{7}.

Задача нашего исследования~-- использовать пространственные связи между датчиками для улучшения качества классификации. Мы предлагаем рассматривать временной ряд как динамический граф, где рёбра представляют взаимосвязи между датчиками в пространстве или статистически. Мы считаем, что учитывание этих факторов позволит построить более качественную и устойчивую модель классификации. Мы рассмотрим подходы построения подобных связей и посмотрим, как они влияют на результат классификации. Проводить оценку качества модели мы будем на открытом датасете SEED IV. В качестве модели мы предлагаем использовать DCGRU, которая хорошо себя показала в схожей проблеме классификации эпилептических припадков по данным электроэнцефалограммы \cite{DCGRU}.



\section{Постановка задачи}

\subsection{Построение матрицы связности}

Исходный сигнал ЭЭГ задан в виде тензора $\mathbf{X} = [\mathbf{X}_m]_{m=1}^M$, $\mathbf{X}_m \in \mathbb{R}^{E \times N}$, где $N$ соответствует числу отсчётов времени при измерении сигнала, $E$ — число электродов, считываемый сигнал, $M$ — число испытаний. Также дана матрица координат электродов $\mathbf{Z} \in \mathbb{R}^{E \times 3}$, определяемая выбранным при снятии электроэнцефалограммы стандартом размещения. В данной работе предлагается рассматривать сигнал в качестве неориентированного динамического графа: 
\[
\mathcal{G}(m,t) = \left( \mathcal{V}(m,t), \mathcal{E}(m,t), \mathbf{A}_{\mathbf{X},\mathbf{Z}}(m,t) \right),
\]
для решения проблемы моделирования пространственной взаимосвязи между электродами на голове испытуемого. В качестве множества вершин $\mathcal{V}(m,t)$ мы рассматриваем электроды, а значениями в вершинах будут значения сигнала в момент $t$. Множество рёбер $\mathcal{E}(m,t)$ задаётся матрицей связности графа $\mathbf{A}_{\mathbf{X},\mathbf{Z}}(m,t)$.

\subsection{Основные определения}

Дана выборка $\mathfrak{D} = (\mathbf{X}, \mathbf{Z}, \mathbf{y})$ активности головного мозга, где:
\begin{itemize}
    \item $\mathbf{X} = [\mathbf{X}_m]_{m=1}^M$ — набор сигналов;
    \item $\mathbf{X}_m = [\mathbf{x}_t]_{t \in T}$ — сигнал, полученный в $m$-м испытании;
    \item $\mathbf{x}_t \in \mathbb{R}^E$ — наблюдения сигнала в момент времени $t$;
    \item $\mathbf{Z} = [\mathbf{z}_k]_{k=1}^E$, $\mathbf{z}_k \in \mathbb{R}^3$ — координаты электродов;
    \item $\mathbf{y} = [y_m]_{m=1}^M$ — целевая переменная;
    \item $y_m \in \{1, \ldots, C\}$ — метка класса;
    \item $T = \{t_n\}_{n=1}^N$ — набор временных отсчётов;
    \item $E = 62$ — число электродов;
    \item $N$ — число наблюдений в одном отрезке сигнала.
\end{itemize}

Для решения задачи декодирования рассматривается модель из класса графовых рекуррентных диффузионных нейронных сетей:

\begin{equation}
    h_\theta : (\mathbf{X}, \mathbf{\Delta}_{\mathbf{X},\mathbf{Z}}^*) \to \mathbf{y}.
\end{equation}

В качестве функции ошибки выбрана кросс-энтропия:

\begin{equation}
    \mathcal{L} = -\frac{1}{M} \sum_{m=1}^M \left[ \sum_{c=1}^C \mathbf{I}(y_m = c) \log(p_m^c) \right],
\end{equation}
где $p_m^c = h_\theta \left( \mathbf{X}_m, \mathbf{\Delta}_{\mathbf{X},\mathbf{Z}}^*(m) \right)$ — вероятность класса $c$ для $\mathbf{X}_m$ с матрицей $\mathbf{\Delta}_{\mathbf{X},\mathbf{Z}}^*(m)$.

Задача поиска оптимальных параметров имеет следующий вид:

\begin{equation}
    \hat{\theta} = \arg \max_{\theta} \mathcal{L}(\theta, \mathbf{X}, \mathbf{\Delta}_{\mathbf{X},\mathbf{Z}}^*).
\end{equation}

\section{Построение матрицы связности}

В этом разделе описываются методы построения матрицы смежности через оценку взаимосвязи между временными рядами, соответствующими электродам. Мы рассматриваем построение матрицы смежности на основе синхронизации фаз сигналов.

\subsection{Синхронизация фаз сигналов}

Фазовая синхронизация представляет собой подход к анализу возможных нелинейных взаимозависимостей и фокусируется на фазах сигналов. Предполагается, что две динамические системы могут иметь синхронизацию фаз, даже если их амплитуды независимы. Обозначим $x(t)$, $y(t)$ — динамические системы, соответствующие наблюдениям сигнала $\mathbf{x}_{mi}$ и $\mathbf{x}_{mj}$ в отрезке времени $[t_n - T_w, t_n]$ в $m$-м испытании. Синхронизация фаз понимается как:

\begin{equation}
|\phi_x(t) - \phi_y(t)| = \text{const}.
\end{equation}

Для оценки фазы вычисляется аналитическое представление сигнала с использованием преобразования Гильберта:

\begin{equation}
H(t) = x(t) + i\dot{x}(t),
\end{equation}

где

\begin{equation}
\dot{x}(t) = \frac{1}{\pi} \text{v.p.} \int_{-\infty}^{\infty} \frac{x(t')}{t - t'} dt' \quad \text{— преобразование Гильберта сигнала } x(t),
\end{equation}

\noindent где v.p. — главное значение интеграла по Коши.

Фаза аналитического сигнала определяется как:

\begin{equation}
\phi(t) = \arctan \left( \frac{\dot{x}(t)}{x(t)} \right).
\end{equation}

Таким образом, для двух сигналов $x(t)$, $y(t)$ равной продолжительности $T_w$ с фазами $\phi_x(t)$, $\phi_y(t)$ значение синхронизации фаз (phase locking value) \cite{9} задаётся уравнением:

\begin{equation}
p_{ij}(m, t_n) = \left| \frac{1}{T_w} \sum_{k=1}^{T_w} \exp \left( i(\phi_x(k \Delta t) - \phi_y(k \Delta t)) \right) \right|,
\end{equation}

где $\Delta t$ — шаг по времени, $i = \sqrt{-1}$.

Матрица связности определяется как:

\begin{equation}
\mathbf{A}_{\mathbf{X}, Z}^*(m, t) = [a_{ij}(m, t)] \in \mathbb{R}_+^{E \times E}, \quad a_{ij}(m, t) = 
\begin{cases} 
p_{ij}(m, t), & \text{если } p_{ij}(m, t) \geq \rho(p), \\
0, & \text{иначе}.
\end{cases}
\end{equation}



\section{Модель классификации}

Для решения задачи классификации мы предлагаем использовать модель \textbf{DCGRU}~\cite{DCRNN}, хорошо показавшую себя в задаче классификации эпилептических припадков по ЭЭГ в работе~\cite{DCGRU}. Мы считаем, что использование диффузии позволит учитывать удалённые вершины графа, что улучшит качество классификации, а также сделает модель более устойчивой к шуму, что важно, поскольку ЭЭГ-данные крайне индивидуальны.

Для моделирования диффузии на графе используется спектральная свёртка, определяемая как:
\[
X_{:,p} \star_{\mathcal{G}} f_\theta = \Phi F(\theta) \Phi^\top X_{:,p},
\]
где:
\begin{itemize}
    \item $L = \Phi \Lambda \Phi^\top$ — спектральное разложение лапласиана графа;
    \item $F(\theta) = \sum_{k=0}^{K-1} \theta_k \Lambda^k$ — полиномиальный фильтр;
    \item $p$ — индекс признака вершины.
\end{itemize}

Эта операция эквивалентна диффузионной свёртке на графе с точностью до преобразования подобия, если граф $\mathcal{G}$ является неориентированным~\cite{DCRNN}.

Ядро модели описывается следующими уравнениями:

\begin{align*}
r^{(t)} &= \sigma\left(\Theta_r \star_{g} \left[X^{(t)}, H^{(t-1)}\right] + b_r\right), \\
u^{(t)} &= \sigma\left(\Theta_u \star_{g} \left[X^{(t)}, H^{(t-1)}\right] + b_u\right), \\
C^{(t)} &= \tanh\left(\Theta_C \star_{g} \left[X^{(t)}, \left(r^{(t)} \odot H^{(t-1)}\right)\right] + b_c\right), \\
H^{(t)} &= u^{(t)} \odot H^{(t-1)} + \left(1 - u^{(t)}\right) \odot C^{(t)}.
\end{align*}

где:
\begin{itemize}
    \item $X^{(t)}$, $H^{(t)}$ — вход и выход на временном шаге $t$;
    \item $r^{(t)}$, $u^{(t)}$ — вентиль сброса и вентиль обновления;
    \item $\Theta_r$, $\Theta_u$, $\Theta_C$ — обучаемые параметры фильтров;
    \item $\star_{g}$ — оператор диффузионной свёртки;
    \item $\odot$ — поэлементное умножение;
    \item $\sigma$ — сигмоидальная функция активации.
\end{itemize}

\section{Признаковое описание}

В качестве признаков используются значения дифференциальной энтропии для следующих диапазонов ритмов головного мозга:
\begin{itemize}
    \item дельта (1--3~Гц);
    \item тета (4--7~Гц);
    \item альфа (8--13~Гц);
    \item бета (14--30~Гц);
    \item гамма (31--50~Гц).
\end{itemize}

Формула дифференциальной энтропии для нормально распределённой случайной величины $Y \sim \mathcal{N}(\mu, \sigma^2)$ имеет вид:
\begin{equation}
DE(Y) = -\int_{-\infty}^{\infty} \frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(y - \mu)^2}{2\sigma^2}} \log \left( \frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(y - \mu)^2}{2\sigma^2}} \right) dy.
\end{equation}

Таким образом, в каждый момент времени $t$ графовый сигнал имеет размерность:
\[
x_t \in \mathbb{R}^{62 \times 5},
\]
где:
\begin{itemize}
    \item 62 — количество электродов;
    \item 5 — количество частотных диапазонов.
\end{itemize}

\section{План вычислительного эксперимента}

\textbf{Гипотеза:} учёт пространственной и функциональной структуры ЭЭГ-сигнала, а также использование диффузионных методов повышает качество классификации эмоциональных состояний человека.

\textbf{Цели эксперимента:}
\begin{enumerate}
    \item Построить матрицы связей между электродами с использованием различных методов.
    \item Оценить качество работы предложенной пространственно-временной модели на основе построенных графов.
\end{enumerate}

В исследовании использовался набор данных~\cite{Dataset}, предназначенный для анализа аффективных состояний человека. В эксперименте участвовали 15 испытуемых, соответствующих необходимым медицинским требованиям. Все участники подписали информированное согласие и были ознакомлены с протоколом исследования.

В качестве визуальных стимулов применялись видеоролики из шести категорий. Критерии отбора видеофрагментов включали:
\begin{itemize}
    \item ограничение по длительности, чтобы избежать утомления;
    \item ясность содержания без дополнительных пояснений;
    \item способность вызывать чётко определённые эмоции.
\end{itemize}

Каждое видео длилось около 4 минут и было специально отредактировано для усиления эмоционального воздействия.

Эксперимент проводился в 3 сессии по 15 попыток. Порядок видео исключал последовательную демонстрацию фрагментов одной категории. После каждого видео участники заполняли опросник с описанием пережитых эмоций.

ЭЭГ записывалась с использованием 62 электродов, расположенных по системе 10--20. Частота дискретизации составляла 1~кГц.

На этапе предобработки применялись:
\begin{itemize}
    \item полосовая фильтрация в диапазоне 0.3--50~Гц для удаления шумов и артефактов;
    \item понижение частоты дискретизации до 200~Гц.
\end{itemize}

\section{Результаты}

В ходе эксперимента было проведено сравнение производительности двух архитектур рекуррентных нейронных сетей: модели с одним рекуррентным слоем и модели с двумя рекуррентными слоями. Исследование также включало анализ влияния длины входной последовательности на качество обучения — для этого использовались данные с последовательностями длиной 12 и 17 элементов. Обучение всех вариантов моделей проводилось на видеокарте NVIDIA Tesla T4, при этом время обучения для каждой конфигурации составило примерно 30 минут.

Наилучшие результаты продемонстрировала модель с двумя рекуррентными слоями, обученная на последовательностях из 17 элементов.

Также стоит отметить, что модели с одним рекуррентным слоем быстрее начинают переобучаться.

\begin{center}
\includegraphics[width=0.7\linewidth]{basic.pdf}
\captionof{figure}{модель с одним реккурентным слоем и группой в 12 элементов} % Подпись без float
\end{center}

\begin{center}
\includegraphics[width=0.7\linewidth]{2_layers.pdf}
\captionof{figure}{модель с двумя реккурентным слоем и группой в 12 элементов} % Подпись без float
\end{center}

\begin{center}
\includegraphics[width=0.7\linewidth]{big_graup.pdf}
\captionof{figure}{модель с одним реккурентным слоем и группой в 17 элементов} % Подпись без float
\end{center}

\begin{center}
\includegraphics[width=0.7\linewidth]{big_graup_2_layers.pdf}
\captionof{figure}{модель с двумя реккурентным слоем и группой в 17 элементов} % Подпись без float
\end{center}

\section{Заключение}

В данной работе предложен подход к классификации эмоциональных состояний человека по данным электроэнцефалографии, учитывающий пространственную и функциональную структуру мозга. Для этого сигнал ЭЭГ интерпретировался как динамический граф, вершинами которого являются электроды, а рёбрами — связи, определяемые на основе фазовой синхронизации сигналов. На основе построенного графа была реализована модель классификации с использованием графовой рекуррентной нейронной сети DCGRU, способной моделировать как временные, так и пространственные зависимости между каналами ЭЭГ.

Предложенный подход позволил достичь более высокой точности классификации по сравнению с базовыми моделями, содержащими примерно такое же количество параметром, но не учитывающими структуру взаимодействий между электродами. Это подтверждает гипотезу о важности учёта пространственно-временной организации мозговой активности при анализе ЭЭГ-сигналов. Результаты эксперимента демонстрируют потенциал графовых нейронных сетей и диффузионных моделей в задачах нейрофизиологического анализа и распознавания эмоций, открывая возможности для дальнейших исследований и применения в системах аффективного взаимодействия, нейрореабилитации и психофизиологической диагностики.

\newpage

\bibliographystyle{plain}
\bibliography{Biblio}

\end{document}